@page "/about"

@implements IDisposable

@using EuroConnector.ClientApp.Data.Models;
@using EuroConnector.ClientApp.Data.Interfaces
@using EuroConnector.ClientApp.Data.Services;

@attribute [Authorize(Roles = "User, Admin, ErpAdmin")]

@inject IVersionService VersionService
@inject HttpInterceptorService Interceptor

<AuthorizeView Roles="User, Admin, ErpAdmin">
    <MudText Typo="Typo.h3" id="page-title">About</MudText>

    <MudText id="api-version">API Version: @(apiVersion is null ? "Loading..." : apiVersion.Version)</MudText>
    <MudText id="api-release-date">Release Date: @(apiVersion is null ? "Loading..." : apiVersion.ReleaseDate?.ToString("d") ?? "Error")</MudText>
</AuthorizeView>

@code
    {
    [CascadingParameter]
    public Error Error { get; set; }

    private ApiVersion apiVersion;

    protected override async Task OnInitializedAsync()
    {
        Interceptor.RegisterEvent();

        try
        {
            var response = await VersionService.GetApiVersion();
            apiVersion = response;
        }
        catch (Exception ex)
        {
            Error.ProcessError(ex);
            apiVersion = new()
            {
                Version = "Error",
            };
        }
    }

    void IDisposable.Dispose() => Interceptor.DisposeEvent();
}
