@page "/about"

@using EuroConnector.ClientApp.Data.Entities;
@using EuroConnector.ClientApp.Data.Interfaces

@inject IVersionService _versionService

<AuthorizeView Roles="User, Admin, ErpAdmin">
    <MudText Typo="Typo.h3" id="page-title">About</MudText>

    <MudText id="api-version">API Version: @(apiVersion is null ? "Loading..." : apiVersion.Version)</MudText>
    <MudText id="api-release-date">Release Date: @(apiVersion is null ? "Loading..." : apiVersion.ReleaseDate?.ToString("d") ?? "Error")</MudText>
</AuthorizeView>

@code
    {
    [CascadingParameter]
    public Error Error { get; set; }

    private ApiVersion apiVersion;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await _versionService.GetApiVersion();
            apiVersion = response;
        }
        catch (Exception ex)
        {
            Error.ProcessError(ex);
            apiVersion = new()
            {
                Version = "Error",
            };
        }
    }
}
